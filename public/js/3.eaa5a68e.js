(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"5af5":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"row"},[i("div",{staticClass:"col-3"},[i("q-card",{staticClass:"table-bg no-shadow"},[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("Filtro por Categorías")])]),i("q-card-section",[t._l(t.categories,(function(e,a){return i("q-expansion-item",{key:e.id,attrs:{popup:"",group:"categoryFilter","expand-separator":"","expand-icon-toggle":""},scopedSlots:t._u([{key:"header",fn:function(){return[i("q-item-section",{class:{selected:e.selected,pointer:!0},on:{click:function(i){t.updateProductListWithCategory(e),e.selected=!0}}},[t._v("\r\n              "+t._s(e.name)+"\r\n            ")])]},proxy:!0}],null,!0)},t._l(t.categories[a].subcategories,(function(e){return i("q-item",{key:e.id,class:{selected:e.selected},staticStyle:{"border-radius":"30px"},attrs:{label:e.name}},[i("q-item-section",{staticClass:"pointer q-ml-lg",on:{click:function(i){t.updateProductListWithSubcategory(e),e.selected=!0}}},[t._v("\r\n              "+t._s(e.name)+"\r\n            ")])],1)})),1)})),i("div",{staticClass:"q-ma-md"},[t.activeCategoryFilter?i("q-btn",{staticClass:"text-capitalize",attrs:{color:"positive"},on:{click:function(e){return t.resetCategoryFilter()}}},[t._v("\r\n        Restaurar\r\n        ")]):t._e()],1)],2)],1)],1),i("div",{staticClass:"col-9"},[i("q-card",{staticClass:"table-bg no-shadow"},[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("Productos")])]),i("q-separator",{attrs:{color:"white"}}),i("q-card-section",{staticClass:"q-pa-none"},[i("q-table",{staticClass:"table-bg",attrs:{data:t.products,columns:t.columns,"visible-columns":t.visibleColumns,filter:t.filter,pagination:t.pagination},scopedSlots:t._u([{key:"top-left",fn:function(){return[i("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:t._u([{key:"append",fn:function(){return[i("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})]},proxy:!0},{key:"top-right",fn:function(){return[i("q-btn",{staticClass:"float-right text-capitalize",attrs:{color:"positive",icon:"add"},on:{click:function(e){t.addProductDialog=!0}}})]},proxy:!0},{key:"body-cell-Price",fn:function(e){return[i("td",{staticClass:"text-left"},[t._v("$"+t._s(e.row.price.toFixed(2)))])]}},{key:"body-cell-Action",fn:function(e){return[i("q-td",{attrs:{props:e}},[i("q-btn",{staticClass:"q-ml-sm",attrs:{icon:"share",size:"sm",flat:"",dense:""},on:{click:function(i){return t.relateProduct(e.row)}}}),i("q-btn",{staticClass:"q-ml-sm",attrs:{icon:"edit",size:"sm",flat:"",dense:""},on:{click:function(i){return t.editProduct(e.row)}}}),i("q-btn",{staticClass:"q-ml-sm",attrs:{icon:"delete",size:"sm",flat:"",dense:""},on:{click:function(i){return t.deleteProduct(e.row)}}})],1)]}},{key:"body-cell-Description",fn:function(e){return[i("q-td",{attrs:{props:e}},[t._v("\r\n            "+t._s(e.row.description.substr(0,10)+"…")+"\r\n          ")])]}},{key:"body-cell-Image",fn:function(e){return[i("q-td",{staticStyle:{height:"100px",width:"100px"},attrs:{props:e}},[e.row.image_url?i("q-img",{attrs:{src:"http://api.pediapp.com.ar/images/"+e.row.image_url,fit:"fill"}}):t._e()],1)]}},{key:"body-cell-Active",fn:function(e){return[i("q-td",{attrs:{props:e}},[i("q-checkbox",{attrs:{disable:""},model:{value:e.row.active,callback:function(i){t.$set(e.row,"active",i)},expression:"props.row.active"}})],1)]}},{key:"body-cell-Stock",fn:function(e){return[i("q-td",{attrs:{props:e}},[i("q-checkbox",{attrs:{disable:""},model:{value:e.row.stock,callback:function(i){t.$set(e.row,"stock",i)},expression:"props.row.stock"}})],1)]}}])})],1),i("q-dialog",{attrs:{persistent:""},model:{value:t.addProductDialog,callback:function(e){t.addProductDialog=e},expression:"addProductDialog"}},[i("q-card",{staticStyle:{"min-width":"750px"}},[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v(t._s(t.formTitle))])]),i("q-card-section",{staticClass:"q-pt-none"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col q-mx-sm"},[i("q-input",{attrs:{dense:"",label:"Nombre"},model:{value:t.editedItem.name,callback:function(e){t.$set(t.editedItem,"name",e)},expression:"editedItem.name"}})],1),i("div",{staticClass:"col q-mx-sm"},[i("q-input",{attrs:{dense:"",label:"Precio"},model:{value:t.editedItem.price,callback:function(e){t.$set(t.editedItem,"price",e)},expression:"editedItem.price"}})],1)]),i("div",{staticClass:"row q-mt-md"},[i("div",{staticClass:"col q-mx-sm"},[i("q-input",{attrs:{dense:"",clearable:"",autogrow:"",label:"Descripción",type:"textarea"},model:{value:t.editedItem.description,callback:function(e){t.$set(t.editedItem,"description",e)},expression:"editedItem.description"}})],1)]),i("div",{staticClass:"row q-mt-md justify-center"},[i("div",{staticClass:"col-2 q-mx-sm"},[i("q-checkbox",{attrs:{label:"Activo?","left-label":""},model:{value:t.editedItem.active,callback:function(e){t.$set(t.editedItem,"active",e)},expression:"editedItem.active"}})],1),i("div",{staticClass:"col-2 q-mx-sm"},[i("q-checkbox",{attrs:{label:"Tiene Stock?","left-label":""},model:{value:t.editedItem.stock,callback:function(e){t.$set(t.editedItem,"stock",e)},expression:"editedItem.stock"}})],1)]),i("div",{staticClass:"row q-mt-md justify-center"},[i("div",{staticClass:"col-6 q-mx-sm"},[i("q-file",{attrs:{rounded:"",outlined:"",type:"file","bottom-slots":"",label:"Foto Principal",counter:"","max-file-size":"2097152","max-files":"1",accept:".jpg, image/*"},on:{rejected:t.onRejected},scopedSlots:t._u([{key:"before",fn:function(){return[i("q-icon",{attrs:{name:"image"}})]},proxy:!0},{key:"append",fn:function(){return[null!==t.editedItem.image_url?i("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(e){e.stopPropagation(),t.editedItem.image_url=null}}}):t._e(),i("q-icon",{attrs:{name:"search"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0},{key:"hint",fn:function(){return[t._v(" Tamaño máximo 2MB - 950 x 950 px. ")]},proxy:!0}]),model:{value:t.editedItem.file,callback:function(e){t.$set(t.editedItem,"file",e)},expression:"editedItem.file"}})],1)]),i("div",{staticClass:"row q-mt-md justify-center"},[t._v("\r\n            Fotos adjuntas\r\n          ")]),i("div",{staticClass:"row q-mt-md justify-center"},t._l(t.attachedProductImages,(function(e,a){return i("div",{key:e.id},[i("q-chip",{attrs:{removable:""},on:{remove:function(e){return t.attachedProductImages.splice(a,1)}}},[i("q-img",{attrs:{src:"http://api.pediapp.com.ar/images/"+e.image_url,height:"auto",width:"50px",ratio:1}})],1)],1)})),0),i("div",{staticClass:"row q-mt-md justify-center"},[i("div",{staticClass:"col-6 q-mx-sm"},[i("q-file",{attrs:{rounded:"",outlined:"",type:"file","bottom-slots":"",label:"Fotos adicionales",counter:"","max-file-size":"2097152","max-files":"6",multiple:"",accept:".jpg, image/*"},on:{rejected:t.onRejected},scopedSlots:t._u([{key:"before",fn:function(){return[i("q-icon",{attrs:{name:"image"}})]},proxy:!0},{key:"append",fn:function(){return[null!==t.editedItem.additional_images?i("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(e){e.stopPropagation(),t.editedItem.additional_images=null}}}):t._e(),i("q-icon",{attrs:{name:"search"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0},{key:"hint",fn:function(){return[t._v(" Tamaño máximo 2MB - 950 x 950 px. ")]},proxy:!0}]),model:{value:t.editedItem.additional_images,callback:function(e){t.$set(t.editedItem,"additional_images",e)},expression:"editedItem.additional_images"}})],1)])]),i("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[i("q-btn",{attrs:{flat:"",label:"Cancelar"},on:{click:t.closeNewProductDialog}}),i("q-btn",{attrs:{flat:"",label:t.formTitle},on:{click:t.saveNewProduct}})],1)],1)],1),i("q-dialog",{attrs:{persistent:""},model:{value:t.relateProductDialog,callback:function(e){t.relateProductDialog=e},expression:"relateProductDialog"}},[i("q-card",{staticStyle:{"min-width":"750px"}},[i("q-card-section",[i("div",{staticClass:"text"},[t._v("Seleccionar Categoria/s o Subcategoría/s a relacionar")])]),i("q-card-section",{staticClass:"scroll"},[t._l(t.categories,(function(e,a){return i("q-expansion-item",{key:e.id,attrs:{popup:"",group:"categoryRelations","expand-separator":"","expand-icon-toggle":""},scopedSlots:t._u([{key:"header",fn:function(){return[i("q-item-section",{staticClass:"pointer",on:{click:function(i){return t.setSelectedCategories(e)}}},[t._v("\r\n              "+t._s(e.name)+"\r\n            ")])]},proxy:!0}],null,!0)},t._l(t.categories[a].subcategories,(function(a){return i("q-item",{key:a.id,attrs:{label:a.name}},[i("q-item-section",{staticClass:"pointer",on:{click:function(i){return t.setSelectedSubcategories(e,a)}}},[t._v("\r\n              "+t._s(a.name)+"\r\n            ")])],1)})),1)})),i("div",[i("div",{staticClass:"text"},[t._v("Categorías seleccionadas")]),t._l(t.selectedCategories,(function(e,a){return i("q-chip",{key:e.id,attrs:{removable:"",label:e.name,icon:"bookmark",color:"blue","text-color":"white"},on:{remove:function(i){return t.unsetSelectedCategories(e,a)}}})}))],2),i("div",[i("div",{staticClass:"text"},[t._v("Subcategorías seleccionadas")]),t._l(t.selectedSubcategories,(function(e,a){return i("q-chip",{key:e.id,attrs:{removable:"",label:e.name,icon:"bookmark",color:"red","text-color":"white"},on:{remove:function(e){return t.selectedSubcategories.splice(a,1)}}})}))],2)],2),i("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[i("q-btn",{attrs:{flat:"",label:"Cancelar"},on:{click:t.closeRelationDialog}}),i("q-btn",{attrs:{flat:"",label:"Relacionar Subcategorias"},on:{click:t.saveNewSubcategoryRelation}})],1)],1)],1)],1)],1)])},o=[],c=i("7037"),s=i.n(c),r=(i("d81d"),i("b0c0"),i("cca6"),i("159b"),i("a434"),i("a4d3"),i("e01a"),i("7db0"),i("758b")),n={name:"ProductsTable",created:function(){this.getProducts(),this.getCategories(),this.getSubcategories()},data:function(){return{products:[],categories:[],subcategories:[],selectedCategories:[],selectedSubcategories:[],attachedProductImages:[],filter:"",activeCategoryFilter:!1,subcategoryFilter:[],columns:[{name:"Id",label:"ID",field:"id",sortable:!0,align:"left"},{name:"Image",label:"",field:"image_url",sortable:!0,align:"left"},{name:"Name",label:"Nombre",field:"name",sortable:!0,align:"left"},{name:"Price",label:"Precio",field:"price",sortable:!0,align:"left"},{name:"Description",label:"Descripción",field:"description",sortable:!0,align:"left"},{name:"Active",label:"Activo",field:"active",sortable:!0,align:"center"},{name:"Stock",label:"Stock",field:"stock",sortable:!0,align:"center"},{name:"Action",label:"Acciones",field:"Action",sortable:!0,align:"center"},{name:"Subcategories",label:"Subcategorias",field:"subcategories",align:"center"}],visibleColumns:["Id","Name","Price","Description","Active","Stock","Image","Action"],pagination:{rowsPerPage:5},addProductDialog:!1,relateProductDialog:!1,editedIndex:-1,editedItem:{name:"",price:"",description:"",file:null,image_url:"",active:!0,stock:!0,product_images:[],additional_images:null},defaultItem:{name:"",price:"",description:"",file:null,image_url:"",active:!0,stock:!0,product_images:[],additional_images:null}}},computed:{formTitle:function(){return-1===this.editedIndex?"Crear Producto":"Editar Producto"}},methods:{getProducts:function(){var t=this;r["a"].get("products").then((function(e){t.products=e.data})).catch((function(t){console.log("error"+t)}))},getCategories:function(){var t=this;r["a"].get("categories").then((function(e){t.categories=e.data})).catch((function(t){console.log("error"+t)}))},getSubcategories:function(){var t=this;r["a"].get("subcategories").then((function(e){t.subcategories=e.data,t.subcategories=t.subcategories.map((function(t){return t["label"]=t["name"],t["value"]=t["id"],delete t["name"],delete t["id"],t}))})).catch((function(t){console.log("error"+t)}))},editProduct:function(t){var e=this;this.editedIndex=this.products.indexOf(t),this.editedItem=Object.assign({},t),this.products[this.editedIndex].product_images&&this.products[this.editedIndex].product_images.forEach((function(t){e.attachedProductImages.push(t)})),this.addProductDialog=!0},deleteProduct:function(t){var e=this.products.indexOf(t),i=this.products[e].id;confirm("Estás seguro que querés eliminar este producto?")&&this.products.splice(e,1)&&r["a"].delete("products/deleteProduct/".concat(i)).catch((function(t){console.log(t.response)}))},relateProduct:function(t){var e=this;this.relateProductDialog=!0,this.editedIndex=this.products.indexOf(t),this.products[this.editedIndex].categories.forEach((function(t){e.selectedCategories.push(t)})),this.products[this.editedIndex].subcategories.forEach((function(t){e.selectedSubcategories.push(t)}))},closeNewProductDialog:function(){var t=this;this.addProductDialog=!1,this.$nextTick((function(){t.editedItem=Object.assign({},t.defaultItem),t.editedIndex=-1,t.attachedProductImages=[]}))},closeRelationDialog:function(){var t=this;this.relateProductDialog=!1,this.$nextTick((function(){t.selectedCategories=[],t.selectedSubcategories=[]}))},saveNewProduct:function(){var t=this,e=new FormData;if(e.set("name",this.editedItem.name),e.set("price",this.editedItem.price),e.set("description",this.editedItem.description),e.set("active",this.editedItem.active),e.set("stock",this.editedItem.stock),e.append("file",this.editedItem.file),this.editedIndex>-1){this.handleAttachedImagesForExistingProduct();var i=this.editedIndex;r["a"].put("products/editProduct/".concat(this.products[i].id),e).then((function(e){Object.assign(t.products[i],{id:e.data.id,name:e.data.name,price:e.data.price,description:e.data.description,file:null,image_url:e.data.image_url,active:e.data.active,stock:e.data.stock,additional_images:e.data.additional_images})})).catch((function(t){console.log(t)}))}else{var a=this;r["a"].post("products/addProduct",e).then((function(e){t.products.push({id:e.data.id,name:e.data.name,price:e.data.price,description:e.data.description,file:null,image_url:e.data.image_url,active:e.data.active,stock:e.data.stock,additional_images:e.data.additional_images}),a.handleAttachedImagesForNewProduct(e.data.id),a.closeNewProductDialog()})).catch((function(t){console.log(t.response.data.errors.message)}))}},handleAttachedImagesForExistingProduct:function(){var t=this,e=this.editedIndex;this.products[e].product_images.forEach((function(i){var a=t.attachedProductImages.some((function(t){return t.id==i.id}));a||r["a"].post("products/separateImageFromProduct",{productId:t.products[e].id,imageId:i.id})})),void 0!=this.editedItem.additional_images&&this.editedItem.additional_images.forEach((function(i){var a=new FormData;console.log(s()(t.products[e].id)),a.set("productId",t.products[e].id),a.append("additional_images",i);var o=t;r["a"].post("products/relateImageToProduct",a).then((function(){o.getProducts()}))}))},handleAttachedImagesForNewProduct:function(t){var e=this;void 0!=this.editedItem.additional_images&&this.editedItem.additional_images.forEach((function(i){var a=new FormData;a.set("productId",t),a.append("additional_images",i);var o=e;r["a"].post("products/relateImageToProduct",a).then((function(){o.getProducts()}))}))},setSelectedCategories:function(t){void 0===this.selectedCategories.find((function(e){return e.id==t.id}))&&this.selectedCategories.push(t)},setSelectedSubcategories:function(t,e){void 0===this.selectedCategories.find((function(e){return e.id==t.id}))&&this.selectedCategories.push(t),void 0===this.selectedSubcategories.find((function(t){return t.id==e.id}))&&this.selectedSubcategories.push(e)},unsetSelectedCategories:function(t,e){var i=this;this.selectedCategories.splice(e,1);var a=this.categories.find((function(e){return e.id==t.id})).subcategories;a.forEach((function(t){var e=i.selectedSubcategories.indexOf(i.selectedSubcategories.find((function(e){return e.id==t.id})));e>=0&&i.selectedSubcategories.splice(e,1)}))},saveNewSubcategoryRelation:function(){var t=this,e=this.editedIndex;this.products[e].categories.forEach((function(i){var a=t.selectedCategories.some((function(t){return t.id==i.id}));a||r["a"].post("products/separateProductFromCategory",{productId:t.products[e].id,categoryId:i.id})})),this.products[e].subcategories.forEach((function(i){var a=t.selectedSubcategories.some((function(t){return t.id==i.id}));a||r["a"].post("products/separateProductFromSubcategory",{productId:t.products[e].id,subcategoryId:i.id})})),this.selectedSubcategories.forEach((function(i){var a=t.products[e].subcategories.some((function(t){return t.id==i.id}));a||r["a"].post("products/relateProductToSubcategory",{productId:t.products[e].id,subcategoryId:i.id})})),this.selectedCategories.forEach((function(i){var a=t.products[e].categories.some((function(t){return t.id==i.id}));a||r["a"].post("products/relateProductToCategory",{productId:t.products[e].id,categoryId:i.id})})),r["a"].get("products").then((function(e){t.products=e.data,t.closeRelationDialog()})).catch((function(t){console.log("error"+t)}))},updateProductListWithCategory:function(t){var e=this;this.categories.forEach((function(t){t.selected=!1,t.subcategories.forEach((function(t){t.selected=!1}))})),this.activeCategoryFilter=!0,r["a"].get("products/findForCategory/".concat(t.id)).then((function(t){e.products=t.data})).catch((function(t){console.log("error"+t)}))},updateProductListWithSubcategory:function(t){var e=this;this.categories.forEach((function(t){t.selected=!1,t.subcategories.forEach((function(t){t.selected=!1}))})),this.activeCategoryFilter=!0,r["a"].get("products/findForSubcategory/".concat(t.id)).then((function(t){e.products=t.data})).catch((function(t){console.log("error"+t)}))},resetCategoryFilter:function(){var t=this;r["a"].get("products").then((function(e){t.products=e.data,t.activeCategoryFilter=!1,t.categories.forEach((function(t){t.selected=!1,t.subcategories.forEach((function(t){t.selected=!1}))}))})).catch((function(t){console.log("error"+t)}))},onRejected:function(){this.$q.notify({type:"negative",message:"Archivo no permitido"})}}},d=n,l=(i("dee7"),i("2877")),u=i("f09f"),p=i("a370"),m=i("3b73"),g=i("66e5"),f=i("4074"),h=i("9c40"),b=i("eb85"),v=i("eaac"),x=i("27f9"),I=i("0016"),k=i("db86"),q=i("068f"),C=i("8f8e"),y=i("24e8"),_=i("7d53"),P=i("b047"),S=i("4b7e"),w=i("eebe"),D=i.n(w),F=Object(l["a"])(d,a,o,!1,null,null,null);e["default"]=F.exports;D()(F,"components",{QCard:u["a"],QCardSection:p["a"],QExpansionItem:m["a"],QItem:g["a"],QItemSection:f["a"],QBtn:h["a"],QSeparator:b["a"],QTable:v["a"],QInput:x["a"],QIcon:I["a"],QTd:k["a"],QImg:q["a"],QCheckbox:C["a"],QDialog:y["a"],QFile:_["a"],QChip:P["a"],QCardActions:S["a"]})},d94c:function(t,e,i){},dee7:function(t,e,i){"use strict";i("d94c")}}]);